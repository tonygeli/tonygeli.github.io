<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>LILAIQUN</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="LILAIQUN"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="LILAIQUN"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="[toc] 1、什么是 Mybatis？1.Mybatis 是⼀个半 ORM（对象关系映射）框架，它内部封装了 JDBC，开发 时只需要关注 SQL 语句本身，不需要 花费精⼒去处理加载驱动、创建连接、 创 建 statement 等繁杂的过程。程序员直 接编写原⽣态 sql，可以严格控制 sql执⾏性能，灵活度⾼。2.MyBatis 可以使⽤ XML 或注解来配 置和映射原⽣信息，将 POJO"><meta property="og:type" content="blog"><meta property="og:title" content="LILAIQUN"><meta property="og:url" content="https://tonygeli.github.io/2022/02/07/208MyBatis/2.8.1.%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%97%AE%E9%A2%98/"><meta property="og:site_name" content="LILAIQUN"><meta property="og:description" content="[toc] 1、什么是 Mybatis？1.Mybatis 是⼀个半 ORM（对象关系映射）框架，它内部封装了 JDBC，开发 时只需要关注 SQL 语句本身，不需要 花费精⼒去处理加载驱动、创建连接、 创 建 statement 等繁杂的过程。程序员直 接编写原⽣态 sql，可以严格控制 sql执⾏性能，灵活度⾼。2.MyBatis 可以使⽤ XML 或注解来配 置和映射原⽣信息，将 POJO"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/4925ef65d1764d2abeab75982197f6d6.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/658577fd8f6e4bfb94945b74192bb7d5.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/19f7239d661149ca847ea7171a542faf.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/3937db9fa56947899d61bc78a04a819d.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/5c8dd828dee64ec6b031c80c0a745d6b.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/2aba0c9e45b1412fb74acd771cebf494.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/09a4d2ca48d740c38f33a061b1b4aa51.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/01a26972e56f4587b43fa1a81eced2e1.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/16b84ced71b647ec85e74efd16a3c789.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/22ee326e02bc46fbadd26be350a682d6.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/fa6b19fd5327477bbb2bdd1ab836f7d8.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/a70eaf14689641b48a0d5a020a0fb4ea.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/281b2ea126e541e39f4f0aa4afe8fffa.png?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/e86c7c377179442fbd8ce481e7e3cc6f.jpeg?lastModify=1623470232"><meta property="og:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/e6cca4863df54c728865ceb9a2448cb3.jpeg?lastModify=1623470232"><meta property="article:published_time" content="2022-02-07T09:08:08.000Z"><meta property="article:modified_time" content="2022-02-07T09:08:08.000Z"><meta property="article:author" content="Tonygeli"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/4925ef65d1764d2abeab75982197f6d6.png?lastModify=1623470232"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://tonygeli.github.io/2022/02/07/208MyBatis/2.8.1.%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%97%AE%E9%A2%98/"},"headline":"LILAIQUN","image":[],"datePublished":"2022-02-07T09:08:08.000Z","dateModified":"2022-02-07T09:08:08.000Z","author":{"@type":"Person","name":"Tonygeli"},"publisher":{"@type":"Organization","name":"LILAIQUN","logo":{"@type":"ImageObject","url":"https://tonygeli.github.io/img/logo.svg"}},"description":"[toc] 1、什么是 Mybatis？1.Mybatis 是⼀个半 ORM（对象关系映射）框架，它内部封装了 JDBC，开发 时只需要关注 SQL 语句本身，不需要 花费精⼒去处理加载驱动、创建连接、 创 建 statement 等繁杂的过程。程序员直 接编写原⽣态 sql，可以严格控制 sql执⾏性能，灵活度⾼。2.MyBatis 可以使⽤ XML 或注解来配 置和映射原⽣信息，将 POJO"}</script><link rel="canonical" href="https://tonygeli.github.io/2022/02/07/208MyBatis/2.8.1.%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%97%AE%E9%A2%98/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?1ecc72096a22e2426f0bc13519c3c3c7";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="LILAIQUN" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/article-17">Share</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-07T09:08:08.000Z" title="2022/2/7 下午5:08:08">2022-02-07</time>发表</span><span class="level-item"><time dateTime="2022-02-07T09:08:08.000Z" title="2022/2/7 下午5:08:08">2022-02-07</time>更新</span><span class="level-item">32 分钟读完 (大约4837个字)</span></div></div><div class="content"><p>[toc]</p>
<h1 id="1、什么是-Mybatis？"><a href="#1、什么是-Mybatis？" class="headerlink" title="1、什么是 Mybatis？"></a>1、什么是 Mybatis？</h1><p>1.Mybatis 是⼀个半 ORM（对象关系映射）框架，它内部封装了 JDBC，开发 时只需要关注 SQL 语句本身，不需要 花费精⼒去处理加载驱动、创建连接、 创 建 statement 等繁杂的过程。程序员直 接编写原⽣态 sql，可以严格控制 sql执⾏性能，灵活度⾼。<br>2.MyBatis 可以使⽤ XML 或注解来配 置和映射原⽣信息，将 POJO 映射成数据库中的记 录 ，避免了⼏乎所有的JDBC代码和⼿动设置参数以及获取结果集。<br>3.通过 xml ⽂件或注解的⽅式将要执⾏的各种 statement 配置起来，并通过 java 对象和 statement 中 sql 的动态参数进⾏映射⽣成最终执⾏的 sql 语句，最后由 mybatis 框架执⾏ sql 并将结果映射为 java 对象并返回。（从执⾏ sql 到返回result 的过程）。 </p>
<h1 id="2-MyBatis的优点"><a href="#2-MyBatis的优点" class="headerlink" title="2.MyBatis的优点"></a>2.MyBatis的优点</h1><p>1.基于 SQL 语句编程，相当灵活，不会对应⽤程序或者数据库的现有设计造成任何影响，SQL 写在 XML ⾥，解除 sql 与程序代码的耦合，便于统⼀管理；提供 XML 标签，⽀持编写动态 SQL 语 句，并可重⽤。<br>2.与 JDBC 相⽐，减少了 50%以上的 代码量，消除了 JDBC ⼤量冗余的代 码， 不需要⼿动开关连接；<br>3.很 好 的 与 各 种 数 据 库 兼 容 （ 因 为 MyBatis 使⽤ JDBC 来连接数据库，所 以 只要 JDBC ⽀持的数据库 MyBatis 都⽀持）。<br>4.能够与 Spring 很好的集成；<br>5.提供映射标签，⽀持对象与数据库的 ORM 字段关系映射；提供对象关系映 射标签，⽀持对象关系组件维护。</p>
<h1 id="3-MyBatis-框架的缺点："><a href="#3-MyBatis-框架的缺点：" class="headerlink" title="3.MyBatis 框架的缺点："></a>3.MyBatis 框架的缺点：</h1><p>1.SQL 语句的编写⼯作量较⼤，尤其当 字段多、关联表多时，对开发⼈员编写 SQL 语句的功底有⼀定要求。<br>2.SQL 语句依赖于数据库，导致数据库 移植性差，不能随意更换数据库。</p>
<h1 id="4、MyBatis-框架适⽤场合："><a href="#4、MyBatis-框架适⽤场合：" class="headerlink" title="4、MyBatis 框架适⽤场合："></a>4、MyBatis 框架适⽤场合：</h1><p>1.MyBatis 专注于 SQL 本身，是⼀个⾜够灵活的 DAO 层解决⽅案。<br>2.对性能的要求很⾼，或者需求变化较 多的项⽬，如互联⽹项⽬，MyBatis 将 是不错的选择。</p>
<h1 id="5、MyBatis-与-Hibernate-有哪些不同？"><a href="#5、MyBatis-与-Hibernate-有哪些不同？" class="headerlink" title="5、MyBatis 与 Hibernate 有哪些不同？"></a>5、MyBatis 与 Hibernate 有哪些不同？</h1><p> 1.Mybatis 和 hibernate 不同，它不完全是</p>
<h2 id="2-MYBATIS之MAPPER接口的注册过程"><a href="#2-MYBATIS之MAPPER接口的注册过程" class="headerlink" title="2.MYBATIS之MAPPER接口的注册过程"></a>2.MYBATIS之MAPPER接口的注册过程</h2><p>Mapper接口用于定义执行SQL语句相关的方法，方法名一般和Mapper XML配置文件中&lt;select|update|delete|insert&gt;标签的id属性相同，接口的完全限定名一般对应Mapper XML配置文件的命名空间。</p>
<p>可以看一下Mapper XML，如下面的UserMapper.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.blog4java.mybatis.example.mapper.UserMapper&quot;&gt;</span><br><span class="line">    &lt;sql id=&quot;userAllField&quot;&gt;</span><br><span class="line">      id,create_time, name, password, phone, nick_name</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;listAllUser&quot;   resultType=&quot;com.blog4java.mybatis.example.entity.UserEntity&quot; &gt;</span><br><span class="line">        select</span><br><span class="line">        &lt;include refid=&quot;userAllField&quot;/&gt;</span><br><span class="line">        from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getUserByEntity&quot;  resultType=&quot;com.blog4java.mybatis.example.entity.UserEntity&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">        &lt;include refid=&quot;userAllField&quot;/&gt;</span><br><span class="line">        from user</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;if test=&quot;id != null&quot;&gt;</span><br><span class="line">                AND id = #&#123;id&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;name != null&quot;&gt;</span><br><span class="line">                AND name = #&#123;name&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;if test=&quot;phone != null&quot;&gt;</span><br><span class="line">                AND phone = #&#123;phone&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getUserByPhone&quot; resultType=&quot;com.blog4java.mybatis.example.entity.UserEntity&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">        &lt;include refid=&quot;userAllField&quot;/&gt;</span><br><span class="line">        from user</span><br><span class="line">        where phone = $&#123;phone&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>UserMapper的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface UserMapper &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;UserEntity&gt; listAllUser();</span><br><span class="line"></span><br><span class="line">    List&lt;UserEntity&gt; getUserByEntity( UserEntity user);</span><br><span class="line"></span><br><span class="line">    UserEntity getUserByPhone(@Param(&quot;phone&quot;) String phone);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看一下如何执行这个UserMapper.xml，参考下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取配置文件输入流</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 通过SqlSessionFactoryBuilder的build()方法创建SqlSessionFactory实例</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"><span class="comment">// 调用openSession()方法创建SqlSession实例</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">// 获取UserMapper代理对象</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="comment">// 执行Mapper方法，获取执行结果</span></span><br><span class="line">List&lt;UserEntity&gt; userList = userMapper.listAllUser();</span><br><span class="line"></span><br><span class="line">System.out.println(JSON.toJSONString(userList));</span><br></pre></td></tr></table></figure>

<p>如上面的代码所示，在创建SqlSession实例后，需要调用SqlSession的getMapper()方法获取一个UserMapper的引用，然后通过该引用调用Mapper接口中定义的方法，UserMapper是一个接口，我们调用SqlSession对象getMapper()返回的到底是什么呢？</p>
<p>我们知道，接口中定义的方法必须通过某个类实现该接口，然后创建该类的实例，才能通过实例调用方法。所以SqlSession对象的getMapper()方法返回的一定是某个类的实例。具体是哪个类的实例呢？实际上getMapper()方法返回的是一个动态代理对象。</p>
<p>我们一步步解析 DefaultSqlSession实现了SqlSession接口，可以直接看一下DefaultSqlSession对getMapper()的具体实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqlSession对象getMapper()具体的实现</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> configuration.&lt;T&gt;getMapper(type, <span class="built_in">this</span>);  <span class="comment">// this:sqlSession</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过调用configuration类的getMapper获取UserMapper的实列，继续看看getMapper的实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Configuration</span> &#123;  <span class="comment">// configuration类的getMapper的实现</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mapperRegistry.getMapper(type, sqlSession);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>configuration类的getMapper的是通过调用mapperRegistry的getMapper方法来实现的</p>
<p><strong>这里的mapperRegistry用于注册Mapper接口信息，建立Mapper接口的Class对象和MapperProxyFactory对象之间的关系，其中MapperProxyFactory对象用于创建Mapper动态代理对象</strong></p>
<p>继续下一步</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/4925ef65d1764d2abeab75982197f6d6.png?lastModify=1623470232" alt="Mybatis之Mapper接口的注册过程"></p>
<p>根据Mapper接口Class对象获取Mapper动态代理对象</p>
<p>Mapper动态代理对象是通过MapperProxyFactory创建的。</p>
<p>重点来了，MapperProxyFactory如何通过动态代理来创建Mapper对象的</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/658577fd8f6e4bfb94945b74192bb7d5.png?lastModify=1623470232" alt="Mybatis之Mapper接口的注册过程"></p>
<p>MapperProxy使用的是JDK内置的动态代理</p>
<p>MapperProxy使用的是JDK内置的动态代理，实现了InvocationHandler接口，invoke()方法中为通用的拦截逻辑，具体内容在介绍Mapper方法调用过程时再做介绍。使用JDK内置动态代理，通过MapperProxy类实现InvocationHandler接口，定义方法执行拦截逻辑后，还需要调用java.lang.reflect.Proxy类的newProxyInstance()方法创建代理对象。</p>
<p>MyBatis对这一过程做了封装，使用MapperProxyFactory创建Mapper动态代理对象。</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/19f7239d661149ca847ea7171a542faf.png?lastModify=1623470232" alt="Mybatis之Mapper接口的注册过程"></p>
<p>MapperProxyFactory类对jdk动态代理做了进一步的封装</p>
<p>如上面的代码所示，MapperProxyFactory类的工厂方法newInstance()是非静态的。也就是说，使用MapperProxyFactory创建Mapper动态代理对象首先需要创建MapperProxyFactory实例。MapperProxyFactory实例是什么时候创建的呢？</p>
<p>Configuration对象中有一个mapperRegistry属性，创建Configuration对象过程中，<a target="_blank" rel="noopener" href="https://www.toutiao.com/item/6956133794403435038/">具体看这篇文章</a>，解析<mappers>标签的时候会调用mapperRegistry中的addMapper(Class<T> type)，创建MapperProxyFactory实例。</p>
<p>MyBatis通过mapperRegistry属性注册Mapper接口与MapperProxyFactory对象之间的对应关系。下面是MapperRegistry类的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">public class MapperRegistry &#123;</span><br><span class="line">  // Configuration对象引用</span><br><span class="line">  private final Configuration config;</span><br><span class="line">  // 用于注册Mapper接口Class对象，和MapperProxyFactory对象对应关系</span><br><span class="line">  private final Map&lt;Class&lt;?&gt;, MapperProxyFactory&lt;?&gt;&gt; knownMappers = new HashMap&lt;Class&lt;?&gt;, MapperProxyFactory&lt;?&gt;&gt;();</span><br><span class="line"></span><br><span class="line">  public MapperRegistry(Configuration config) &#123;</span><br><span class="line">    this.config = config;</span><br><span class="line">  &#125;</span><br><span class="line">  // 根据Mapper接口Class对象获取Mapper动态代理对象</span><br><span class="line">  @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">  public &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) &#123;</span><br><span class="line">    final MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory&lt;T&gt;) knownMappers.get(type);</span><br><span class="line">    if (mapperProxyFactory == null) &#123;</span><br><span class="line">      throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      return mapperProxyFactory.newInstance(sqlSession);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">      throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public &lt;T&gt; boolean hasMapper(Class&lt;T&gt; type) &#123;</span><br><span class="line">    return knownMappers.containsKey(type);</span><br><span class="line">  &#125;</span><br><span class="line">  // 根据Mapper接口Class对象，创建MapperProxyFactory对象，并注册到knownMappers属性中</span><br><span class="line">  public &lt;T&gt; void addMapper(Class&lt;T&gt; type) &#123;</span><br><span class="line">    if (type.isInterface()) &#123;</span><br><span class="line">      if (hasMapper(type)) &#123;</span><br><span class="line">        throw new BindingException(&quot;Type &quot; + type + &quot; is already known to the MapperRegistry.&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      boolean loadCompleted = false;</span><br><span class="line">      try &#123;</span><br><span class="line">        knownMappers.put(type, new MapperProxyFactory&lt;T&gt;(type));</span><br><span class="line">        // It&#x27;s important that the type is added before the parser is run</span><br><span class="line">        // otherwise the binding may automatically be attempted by the</span><br><span class="line">        // mapper parser. If the type is already known, it won&#x27;t try.</span><br><span class="line">        MapperAnnotationBuilder parser = new MapperAnnotationBuilder(config, type);</span><br><span class="line">        parser.parse();</span><br><span class="line">        loadCompleted = true;</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        if (!loadCompleted) &#123;</span><br><span class="line">          knownMappers.remove(type);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @since 3.2.2</span><br><span class="line">   */</span><br><span class="line">  public Collection&lt;Class&lt;?&gt;&gt; getMappers() &#123;</span><br><span class="line">    return Collections.unmodifiableCollection(knownMappers.keySet());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @since 3.2.2</span><br><span class="line">   */</span><br><span class="line">  public void addMappers(String packageName, Class&lt;?&gt; superType) &#123;</span><br><span class="line">    ResolverUtil&lt;Class&lt;?&gt;&gt; resolverUtil = new ResolverUtil&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">    resolverUtil.find(new ResolverUtil.IsA(superType), packageName);</span><br><span class="line">    Set&lt;Class&lt;? extends Class&lt;?&gt;&gt;&gt; mapperSet = resolverUtil.getClasses();</span><br><span class="line">    for (Class&lt;?&gt; mapperClass : mapperSet) &#123;</span><br><span class="line">      addMapper(mapperClass);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @since 3.2.2</span><br><span class="line">   */</span><br><span class="line">  public void addMappers(String packageName) &#123;</span><br><span class="line">    addMappers(packageName, Object.class);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上面的代码所示，MapperRegistry类有一个knownMappers属性，用于注册Mapper接口对应的Class对象和MapperProxyFactory对象之间的关系。另外，MapperRegistry提供了addMapper()方法，用于向knownMappers属性中注册Mapper接口信息。在addMapper()方法中，为每个Mapper接口对应的Class对象创建一个MapperProxyFactory对象，然后添加到knownMappers属性中。</p>
<p>MapperRegistry还提供了getMapper()方法，能够根据Mapper接口的Class对象获取对应的MapperProxyFactory对象，然后就可以使用MapperProxyFactory对象创建Mapper动态代理对象了。</p>
<p>MyBatis框架在应用启动时会解析所有的Mapper接口，然后调用MapperRegistry对象的addMapper()方法将Mapper接口信息和对应的MapperProxyFactory对象注册到MapperRegistry对象中。</p>
<h2 id="3-从源码层面解释：为什么执行MYBATIS接口就可以执行SQL？"><a href="#3-从源码层面解释：为什么执行MYBATIS接口就可以执行SQL？" class="headerlink" title="3.从源码层面解释：为什么执行MYBATIS接口就可以执行SQL？"></a>3.从源码层面解释：为什么执行MYBATIS接口就可以执行SQL？</h2><h1 id="1-场景分析"><a href="#1-场景分析" class="headerlink" title="1:场景分析"></a>1:场景分析</h1><p>在我们使用SpringBoot+MyBatis的时候，我们一般是先引入依赖，然后配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">      mapper-locations: classpath:mapper/*.xml</span><br><span class="line">      type-aliases-package: com.coco.pojo</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当然还要在启动类上加上一个注解</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/3937db9fa56947899d61bc78a04a819d.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>这时候，就可以编写一个接口，然后调用这个方法就可以执行配置文件中对应的SQL语句了</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/5c8dd828dee64ec6b031c80c0a745d6b.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>那么底层原理到底是怎么实现的呢？？</p>
<h1 id="2-万事开头难"><a href="#2-万事开头难" class="headerlink" title="2:万事开头难"></a>2:万事开头难</h1><p>分析一个框架源码的时候最难的就是不知道该从哪开始，我是这样想的，既然我们只要写一个这样的接口，那么就可以调用对应的SQL语句，那么肯定是在哪个环节对这个接口做一些特殊的处理</p>
<p>我们在启动类上加了一个注解，而且注解中的包路径正是我们接口的路径，这时候我们就有点眉目了。</p>
<p>进入 <strong>@MapperScan(“com.coco.mapper”)</strong> 这个注解中</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/2aba0c9e45b1412fb74acd771cebf494.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>我们看到除了注解的基本三个注解之外，还有一个注解就是 <strong>@Import({ MapperScannerRegistrar.class})</strong> ，很多小伙伴可能不知道这个注解有什么用，我们先解释一下</p>
<h1 id="3-SPRINGBOOT中-IMPORT注解的作用"><a href="#3-SPRINGBOOT中-IMPORT注解的作用" class="headerlink" title="3: SPRINGBOOT中@IMPORT注解的作用"></a>3: SPRINGBOOT中@IMPORT注解的作用</h1><p>在SpringBoot中当我们要声明一个Bean的时候，我们可以在该类上加上 <strong>@Service，@Compont</strong> 等，或者是在配置类中加上 <strong>@Bean</strong> 这个注解，除此之外还有一种方法，就是 <strong>@Import</strong></p>
<p>@Import注解中会标明一个类，而且在SpringBoot启动的时候会处理也就是会实例化这个Bean，也就是会对这个Bean做一些处理</p>
<h1 id="4-MAPPERSCANNERREGISTRAR-CLASS的作用"><a href="#4-MAPPERSCANNERREGISTRAR-CLASS的作用" class="headerlink" title="4: MAPPERSCANNERREGISTRAR.CLASS的作用"></a>4: MAPPERSCANNERREGISTRAR.CLASS的作用</h1><p>即然知道了 <strong>@Import</strong> 注解的作用，那现在我们进入到这个类中看看，这个类实现了** ImportBeanDefinitionRegistrar** 这个接口</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/09a4d2ca48d740c38f33a061b1b4aa51.png?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>这个接口有什么用呢？？简单的来说就是MyBatis通过这个入口可以让Spring扫描到某些Bean，并且这些Bean会被Spring所管理，也就是说这些Bean会被Spring进行初始化。</p>
<p>所以我们自定义的Mapper接口会被Spring扫描到，然后会被Spring进行加载</p>
<p>ImportBeanDefinitionRegistrar这个接口就代表着当把Bean生成了对应的 <strong>BeanDefinition</strong> 的时候，就会调用这个接口的方法，我们看下这个接口中定义的方法</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/01a26972e56f4587b43fa1a81eced2e1.png?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>这个方法做什么的呢？？</p>
<p>Spring在加载Bean的时候，首先会将Bean生成一个个的对应的 <strong>BeanDefinition</strong> ，后续就会通过这些一个个的 <strong>BeanDefinition</strong> 来进行初始化，也就是生成对应的Bean。</p>
<p>简而言之：Spring会通过MyBatis提供的 <strong>@MapperScan(“com.coco.mapper”)</strong> 这个注解会扫描我们自定义的Mapper接口，然后Spring就会为这些Mapper接口生成对应的 <strong>BeanDefinition</strong></p>
<h1 id="5-DEBUG模式进入源码"><a href="#5-DEBUG模式进入源码" class="headerlink" title="5: DEBUG模式进入源码"></a>5: DEBUG模式进入源码</h1><p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/16b84ced71b647ec85e74efd16a3c789.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>然后debug模式启动SpringBoot项目，当然前提是整合了MyBatis哈，这个方法我进行了截取，其实只需要关注下面这几行代码就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">  public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123;</span><br><span class="line">    </span><br><span class="line">    //获取到MapperScan注解</span><br><span class="line">    AnnotationAttributes annoAttrs = AnnotationAttributes.fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">    </span><br><span class="line">    ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry);</span><br><span class="line"></span><br><span class="line">    // 获取MapperScan注解中basePackages的属性值</span><br><span class="line">    for (String pkg : annoAttrs.getStringArray(&quot;basePackages&quot;)) &#123;</span><br><span class="line">      if (StringUtils.hasText(pkg)) &#123;</span><br><span class="line">        basePackages.add(pkg);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 真正开始处理这个包路径下的接口，也就是我们的Mapper接口</span><br><span class="line">    scanner.doScan(StringUtils.toStringArray(basePackages));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里就可以获取到我们自定义mapper接口的包的全路径了</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/22ee326e02bc46fbadd26be350a682d6.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<h1 id="6-开始处理MAPPER接口"><a href="#6-开始处理MAPPER接口" class="headerlink" title="6: 开始处理MAPPER接口"></a>6: 开始处理MAPPER接口</h1><p>我们进入到上面的 scanner.doScan(StringUtils.toStringArray(basePackages)); 这个方法</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/fa6b19fd5327477bbb2bdd1ab836f7d8.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>然后进入 <strong>Set beanDefinitions &#x3D; super.doScan(basePackages);</strong> 发现好多代码，其实这个方法的返回值是一个 <strong>BeanDefinitionHolder</strong> 的集合，而 <strong>BeanDefinitionHolder</strong> 就是bean的名称和该bean的BeanDefinition的组成</p>
<p>其实到这里我们应该能明白，这个方法的作用就是：扫描我们自定义的Mapper接口，然后为每一个接口生成一个对应的BeanDefinition，然后将其返回</p>
<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/a70eaf14689641b48a0d5a020a0fb4ea.png?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">protected Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) &#123;</span><br><span class="line">                Assert.notEmpty(basePackages, &quot;At least one base package must be specified&quot;);</span><br><span class="line">                Set&lt;BeanDefinitionHolder&gt; beanDefinitions = new LinkedHashSet&lt;&gt;();</span><br><span class="line">                for (String basePackage : basePackages) &#123;</span><br><span class="line">                        Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);</span><br><span class="line">                        for (BeanDefinition candidate : candidates) &#123;</span><br><span class="line">                                ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(candidate);</span><br><span class="line">                                candidate.setScope(scopeMetadata.getScopeName());</span><br><span class="line">                                String beanName = this.beanNameGenerator.generateBeanName(candidate, this.registry);</span><br><span class="line">                                if (candidate instanceof AbstractBeanDefinition) &#123;</span><br><span class="line">                                        postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);</span><br><span class="line">                                &#125;</span><br><span class="line">                                if (candidate instanceof AnnotatedBeanDefinition) &#123;</span><br><span class="line">                                        AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);</span><br><span class="line">                                &#125;</span><br><span class="line">                                if (checkCandidate(beanName, candidate)) &#123;</span><br><span class="line">                                        BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(candidate, beanName);</span><br><span class="line">                                        definitionHolder =</span><br><span class="line">                                                        AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);</span><br><span class="line">                                        beanDefinitions.add(definitionHolder);</span><br><span class="line">                                        registerBeanDefinition(definitionHolder, this.registry);</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return beanDefinitions;</span><br><span class="line">        &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/281b2ea126e541e39f4f0aa4afe8fffa.png?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>我们debug到这一步可以看到返回值，也证实了我们之前说的</p>
<h1 id="7-拿到BEANDEFINITION之后的处理"><a href="#7-拿到BEANDEFINITION之后的处理" class="headerlink" title="7: 拿到BEANDEFINITION之后的处理"></a>7: 拿到BEANDEFINITION之后的处理</h1><p>现在我们来看下 <strong>processBeanDefinitions(beanDefinitions);</strong> 这个方法，因为之前我们已经拿到了Mapper接口的BeanDefinition了，所以接下来就要进一步的处理</p>
<p>这个方法的代码依旧很多，我这里就不贴出来了，这里我先说一下这个方法是干什么的。</p>
<p>Spring在初始化Bean之前，我们是可以改变Bean的BeanDefinition的属性值得，而这个方法做的事情就是这个，经过这个方法处理之后，我们之前得到的BeanDefiniton会发生一些改变。我这里贴出二张图进行对比一下</p>
<h1 id="这是之前的："><a href="#这是之前的：" class="headerlink" title="这是之前的："></a>这是之前的：</h1><p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/e86c7c377179442fbd8ce481e7e3cc6f.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<h1 id="这是经过该方法处理之后的："><a href="#这是经过该方法处理之后的：" class="headerlink" title="这是经过该方法处理之后的："></a>这是经过该方法处理之后的：</h1><p><img src="file:///Users/admin/Documents/note/%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9C%E4%BA%91/%E7%AC%94%E8%AE%B0/images/e6cca4863df54c728865ceb9a2448cb3.jpeg?lastModify=1623470232" alt="从源码层面解释：为什么执行MyBatis接口就可以执行SQL？"></p>
<p>可以发现该Bean的 <strong>beanClass</strong> 属性变了，已经不再是我们自定义的Bean的class了</p>
<p>改变之后有什么问题呢？？</p>
<p>Spring在初始化Bean的时候，会拿到该Bean的BenDefinition，然后就是根据 <strong>beanClass</strong> 这个属性值初始化Bean，本来我们Mapper接口初始化之后应该就是我们自己定义的Bean，也就是我们执行a.getClass的值应该是 com.xxx.a 这种形式的</p>
<p>但是现在变了，也就是说我们自定义的Mapper接口在被Spring初始化之后，再执行a.getClass会变成** org.mybatis.spring.mapper.MapperFactoryBean**</p>
<h1 id="8-初始化BEAN"><a href="#8-初始化BEAN" class="headerlink" title="8: 初始化BEAN"></a>8: 初始化BEAN</h1><p>经过上面的步骤之后，我们是拿到了Mapper接口的BeanDefinition，现在Spring就要开始初始化这些Bean了</p>
<p>因为此时就涉及到了Spring的源码了，我这里就不细说了</p>
<p>大致的流程：</p>
<p>1: Spring在初始化bean的时候，会根据Bean的scope属性进行初始化，而我们自定义的Mapper接口由于BeanDefinition的beanClass属性被修改了，所以在初始化的时候，经过一系列的判断最终会由MyBatis中的 <strong>MapperProxy</strong> 生成一个代理类，底层是通过jdk动态代理实现的</p>
<p>2: 然后当我们调用Mapper接口方法的时候就会执行 <strong>invoke</strong> 方法，因为是jdk动态代理生成的代理类。</p>
<p>3: 这时候，MyBatis是可以拿到该方法所在的类和该类的全路径的，比如我们在 <strong>com.coco.mapper</strong> 包下自定义了一个 <strong>TestMapper</strong> 接口，然后里面有一个 test() 方法，这时候我们可以通过一系列的方法得到一个值，该值就是:** com.coco.mapper.TestMapper.test** , 也就是该Mapper接口的全路径+方法名</p>
<p>4: MyBatis在解析xml配置文件的时候，有一个 <strong>namespace</strong> 的属性，它的值就是Mapper接口的全路径名，然后加上 id 的值，MyBatis底层会将所有的这种路径全都保存在一个Map中，然后执行接口方法的时候就会根据第3步生成的值去匹配，就能拿到对应的SQL语句了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">    &lt;mapper namespace=&quot;com.coco.mapper.TestMapper&quot;&gt;</span><br><span class="line">        &lt;select id=&quot;test&quot;&gt;</span><br><span class="line">           select * from test</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">    &lt;/mapper&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p><a href="https://tonygeli.github.io/2022/02/07/208MyBatis/2.8.1.介绍与问题/">https://tonygeli.github.io/2022/02/07/208MyBatis/2.8.1.介绍与问题/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Tonygeli</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-02-07</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-02-07</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/10/12000%E9%9D%A2%E8%AF%95/%E9%9D%A2%E8%AF%95%E2%80%94%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"><i class="level-item fas fa-chevron-left"></i><span class="level-item"> </span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/12/29/14000JAVA/4001-JDK-ThreadPoolExecutor/"><span class="level-item"> </span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Tonygeli"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Tonygeli</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>SH</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">154</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">26</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/tonygeli" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux%E5%91%BD%E4%BB%A4/"><span class="level-start"><span class="level-item">Linux命令</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="level-start"><span class="level-item">中间件</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/"><span class="level-start"><span class="level-item">时间管理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%93%E5%AD%98/"><span class="level-start"><span class="level-item">缓存</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BD%91%E7%BB%9C/"><span class="level-start"><span class="level-item">网络</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BB%E4%B9%A6/"><span class="level-start"><span class="level-item">读书</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/"><span class="level-start"><span class="level-item">面试</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bean/"><span class="tag">Bean</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Icarus/"><span class="tag">Icarus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySql/"><span class="tag">MySql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Netty/"><span class="tag">Netty</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Stream/"><span class="tag">Stream</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TCP/"><span class="tag">TCP</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZooKeeper/"><span class="tag">ZooKeeper</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8B%E5%8A%A1/"><span class="tag">事务</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/"><span class="tag">代码优化</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"><span class="tag">公众号</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"><span class="tag">内存分配</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"><span class="tag">分布式事务</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/"><span class="tag">分布式缓存</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/"><span class="tag">单点登录</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A0%86%E7%BC%93%E5%AD%98/"><span class="tag">堆缓存</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tag">大数据</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BC%95%E7%94%A8/"><span class="tag">引用</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E7%A8%8B/"><span class="tag">线程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/"><span class="tag">自动装配</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%99%90%E6%B5%81/"><span class="tag">限流</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-14T09:31:46.339Z">2022-05-14</time></p><p class="title"><a href="/article-17/">130个免费 微信小程序源码分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-14T07:58:07.688Z">2022-05-14</time></p><p class="title"><a href="/2022/05/14/14000JAVA/14002JAVA%E5%9B%9B%E7%A7%8D%E7%BC%93%E5%AD%98/">JAVA四种缓存</a></p><p class="categories"><a href="/categories/%E7%BC%93%E5%AD%98/">缓存</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-13T03:44:34.257Z">2022-05-13</time></p><p class="title"><a href="/2022/05/13/12000%E9%9D%A2%E8%AF%95/12005Spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%886%E7%A7%8D%E5%9C%BA%E6%99%AF/">Spring事务失效6种场景</a></p><p class="categories"><a href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-13T03:43:11.151Z">2022-05-13</time></p><p class="title"><a href="/2022/05/13/12000%E9%9D%A2%E8%AF%95/12004Java%E7%9A%84%E5%BC%95%E7%94%A8%E9%97%AE%E9%A2%98/">Java的引用问题</a></p><p class="categories"><a href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-12T06:50:12.571Z">2022-05-12</time></p><p class="title"><a href="/2022/05/12/12000%E9%9D%A2%E8%AF%95/12003ThreadLocal%E6%BA%90%E7%A0%81/">ThreadLocal源码介绍</a></p><p class="categories"><a href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></p></div></article></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="LILAIQUN" height="28"></a><p class="is-size-7"><span>&copy; 2022 Tonygeli</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>